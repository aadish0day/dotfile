##################
# video settings #
##################
# Use gpu-hq profile (modern replacement for high-quality)
profile=gpu-hq

# Video synchronization
video-sync=display-resample

# Hardware decoding - auto-safe for best compatibility
hwdec=auto-safe
hwdec-codecs=all

# Specify which GPU to use for VA-API decoding
# /dev/dri/renderD128 = RX 6700S (discrete GPU - more powerful)
# /dev/dri/renderD129 = Radeon 680M (integrated GPU - power efficient)
# Comment out to let system choose automatically (usually picks dGPU when plugged in)
# vaapi-device=/dev/dri/renderD128

# Extra frames for copy-back mode (helps with 10-bit)
hwdec-extra-frames=16

# Modern video output (gpu-next is newer, more efficient)
vo=gpu-next,gpu

# Wayland with Vulkan backend
gpu-context=waylandvk
gpu-api=vulkan

# Balanced scaling algorithms (better performance for 4K downscaling)
scale=spline36
cscale=spline36
dscale=mitchell

# Interpolation (motion smoothing for 144Hz)
# Disabled - causes issues with 4K content
interpolation=no
# tscale=oversample

# Override display refresh rate detection
display-fps-override=144

# Lighter debanding for better gradients
deband=yes
deband-iterations=1
deband-threshold=35
deband-range=16
deband-grain=5

# Dithering for better color reproduction
dither-depth=auto
temporal-dither=yes

# HDR tone-mapping (for HDR content on SDR display)
tone-mapping=hable
hdr-compute-peak=yes
hdr-peak-percentile=99.995

# Window size
autofit-larger=90%x90%
keepaspect=yes

##################
# audio settings #
##################
# Audio output (PipeWire is default on modern Arch)
ao=pipewire,pulseaudio,alsa

# Audio channels
audio-channels=auto-safe

# Audio normalization (prevents volume jumps)
# Optimized to prevent unnecessary resampling
af=lavfi=[loudnorm=I=-16:TP=-1.5:LRA=11]

# Larger audio buffer for stability
audio-buffer=0.200

# Allow volume over 100%
volume-max=150
volume=100

##################
# cache settings #
##################
# Cache configuration
cache=yes
demuxer-max-bytes=800M
demuxer-max-back-bytes=200M

# Forward buffer (seconds of video cached ahead)
cache-secs=120

# Don't pause when cache is low
cache-pause=no
cache-pause-initial=yes

# Network streaming optimization
stream-buffer-size=512k

##################
# performance settings #
##################
# Decoder threads (4 is good for 8-core CPU)
vd-lavc-threads=4

# Fast seeking
hr-seek-framedrop=yes
hr-seek=yes

# Direct rendering
vd-lavc-dr=yes

# Subtitle rendering (video mode prevents desync)
blend-subtitles=video

# Skip displaying some frames if behind
video-latency-hacks=no

##################
# subtitle settings #
##################
# Subtitle language preference
slang=en,eng

# Auto-load external subtitle files
sub-auto=fuzzy
sub-file-paths=subs:subtitles

# Subtitle styling
sub-font='Noto Sans'
sub-font-size=48
sub-bold=yes
sub-color='#FFFFFFFF'
sub-border-color='#000000'
sub-border-size=3.0
sub-shadow-offset=1
sub-shadow-color='#33000000'
sub-spacing=0.5

# Subtitle position
sub-pos=95

##################
# audio language #
##################
alang=eng,en,jpn,ja

##################
# screenshot settings #
##################
screenshot-format=png
screenshot-png-compression=8
screenshot-directory=~/Pictures/mpv-screenshots
screenshot-template='%F-%P-%02n'
screenshot-tag-colorspace=yes
screenshot-high-bit-depth=yes

##################
# OSD settings #
##################
osd-level=1
osd-duration=2000
osd-font='Noto Sans'
osd-font-size=40
osd-color='#FFFFFF'
osd-border-color='#000000'
osd-border-size=2
osd-bar-align-y=0.9
osd-bar-w=60
osd-bar-h=2

# Show filename when starting playback
osd-playing-msg='${filename}'

##################
# other settings #
##################
# Keep window open after playback
keep-open=yes

# Save playback position
save-position-on-quit=yes
watch-later-directory=~/.config/mpv/watch_later

# Window title
title='${media-title} - mpv'

# Playlist behavior
loop-playlist=no

# Don't close on exit
keep-open-pause=no

# Force window (useful on Wayland)
force-window=immediate

# Cursor auto-hide delay (milliseconds)
cursor-autohide=1000

# Suppress CUDA/Vulkan spam
msg-level=ffmpeg=error,ao/pipewire=warn

##################
# input settings #
##################
# Enable mouse input
input-doubleclick-time=300
input-right-alt-gr=no

##################
# profiles #
##################

# Profile to force iGPU (680M) for power saving
[igpu]
vaapi-device=/dev/dri/renderD129
hwdec=vaapi

# Profile to force dGPU (RX 6700S) for performance
[dgpu]
vaapi-device=/dev/dri/renderD128
hwdec=vaapi
